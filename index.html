<!doctype html>
<html>
   <h1>
   XHR POST to Server
   </h1>
   <body>
    <select id="content">
      <option value="json">json</option>
      <option value="kvin">kvin</option>
      <option value="string">string</option>
      <option value="array">array</option>
    </select>
     <input type='text' id='num' />
     <script src="./js/kvin.js"></script>
     <script>
      function send () {
        var contentType = document.getElementById('content').value;
        var num = {"L":9}//document.getElementById('num').value; 
        var xhr = new window.XMLHttpRequest()
        xhr.open('POST', '/num', true)
        let body = {};
        xhr.onreadystatechange = function() { 
            if (this.readyState === XMLHttpRequest.DONE && this.status === 200) {
                alert(body);
            }
        }
        if (contentType == 'json') {
          body.contentType = 'application/json'
          body.content = JSON.stringify(num);
        }
        else if (contentType == 'string') {
          body.contentType = 'text/plain'
          body.content = 'toString(num)';
        }
        else if (contentType == 'kvin') {
          body.contentType = 'application/x-kvin'
          body.content = KVIN.stringify(num);
        }
        else if (contentType == 'array') {
          var bytesToSend = [253, 0, 128, 1, 111];
          var bytesArray = new Uint8Array(bytesToSend);

          xhr.setRequestHeader('content-type', 'application/octet-stream');
          xhr.send(bytesArray);
          return;
        }
        // xhr.setRequestHeader('Content-Type', body.content)
        let entries = Object.entries(body);
        body = entries.map((kvp) => `${encodeURIComponent(kvp[0])}=${encodeURIComponent(kvp[1])}`).join('&');
        xhr.setRequestHeader('content-type', 'application/x-www-form-urlencoded');
        xhr.send(body)           
       }
     </script>
     <button type='button' value='Send' name='Send' onclick='send()' >
       Send
     </button>
   </body>
</html>